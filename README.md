# HyperReact, NPM and Webpack

## Overview and prerequisite

In a Isomorphic Ruby world, we need a good way of including Ruby and Javascript components so they co-exist and play nicely together.

Most Ruby libraries are distributed as Gems whereas (these days) most Javascript components are distributed through NPM (and now more recently Yarn). Webpack co-exists well with Rails (sprockets) and the combination of Rails, Yarn, Sprockets and Webpack (albeit a little tricky today to setup) looks like it might become a standard with Rails.

This tutorial assumes that NPM is installed. Please see the NPM websites for installation instructions.

+ [NPM](https://www.npmjs.com/)

Additionally, this tutorial starts with an existing Rails app with **HyperReact already setup and working**. For more information on hot to get to that stage, please see the [HyperReact and Rails Tutorial](http://ruby-hyperloop.io/tutorials/hyperreact_with_rails/).

## Getting started

If you have completed all the steps above, let's get started - there are a few steps to this process:

+ Adding Webpack to your project
+ Setting up Webpack so that it generates assets for server side pre-rendering and client side rendering
+ Installing React and ReactDOM via NPM
+ Updating the Rails asset pipeline to use the bundles generated by Webpack

### Step 1 - Adding Webpack to your project

Run these three commands:

`npm init` will create an empty package.json in your root folder

`npm install webpack --save-dev` install Webpack and create a node_modules folder

`npm install webpack -g` so we can run Webpack from the command line

The commands above will have created a `package.json` (similar concept to a Gemfile) and a `node_modules` folder containing hundreds of JavaScript dependancies that we do not need in the source of our project so let's tell git to ignore them by adding a `.gitignore` file:

```
#/.gitignore
/node_modules
```

### Step 2 - Setting up Webpack

Now that we have Webpack, we need to add 3 boiler plate files to configure it. As you add more javascript packages you will be updating these files. Again this is similar to updating your Gemfile when you add new gems to a project.

Add `webpack.config.js` to the root of your project:

```javascript
// webpack.config.js
var path = require("path");

module.exports = {
    context: __dirname,
    entry: {
      client_only:  "./webpack/client_only.js",
      client_and_server: "./webpack/client_and_server.js"
    },
    output: {
      path: path.join(__dirname, 'app', 'assets',   'javascripts', 'webpack'),
      filename: "[name].js",
      publicPath: "/webpack/"
    },
    module: {
      loaders: [
        // add any loaders here
      ]
    },
    resolve: {
      root: path.join(__dirname, '..', 'webpack')
    },
};
```

Then create a folder called webpack and add the following two files:

```javascript
// webpack/client_only.js
// any packages that depend specifically on the DOM go here
// for example the webpack css loader generates code that will break prerendering
console.log('client_only.js loaded');
```

```javascript
// webpack/client_and_server.js
// all other packages that you can run on both server (prerendering) and client go here
// most well behaved packages can be required here
ReactDOM = require('react-dom')
React = require('react')
console.log('client_and_server.js loaded')
```

### Step 3 - Installing React and ReactDOM

This step is really simple as we have NPM installed. Just run these two commands. Note how this modifies your 'package.json' and installs React and ReactDOM in your `node_modules` folder.

`npm install react --save` to install React
`npm install react-dom --save` to install ReactDOM
